---
- name: Configure all settings
  hosts: all
  gather_facts: false
  module_defaults:
    group/rhc.maas_settings.maas_settings_group:
      username: "{{ maas_username }}"
      password: "{{ maas_password }}"
      site: "{{ maas_site }}"
  tasks:
    - name: Configure VLANs
      rhc.maas_settings.maas_vlans:
        vlans: "{{ maas_configs['vlans'] }}"
        state: exact
      delegate_to: localhost

    - name: Configure Subnets
      rhc.maas_settings.maas_subnets:
        subnets: "{{ maas_configs['subnets'] + maas_configs['untagged_subnets'] }}"
        state: exact
      delegate_to: localhost

    - name: Configure Node Scripts
      rhc.maas_settings.maas_node_scripts:
        script_dir: "{{ maas_configs['node_scripts']['scripts_dir'] }}"
        user_scripts: "{{ maas_configs['node_scripts']['user_scripts'] }}"
        state: exact
      delegate_to: localhost

    - name: Configure Tags
      rhc.maas_settings.maas_tags:
        tags: "{{ maas_configs['tags'] }}"
        state: exact
      delegate_to: localhost

    - name: Configure Maas Settings
      rhc.maas_settings.maas_configs:
        configs: "{{ maas_configs['maas'] }}"
      delegate_to: localhost

        #    - name: Clean up static routes
        #      rhc.maas_settings.maas_static_routes:
        #        static_routes: "{{ maas_configs['static_routes'] }}" 
        #        state: exact
        #      delegate_to: localhost

